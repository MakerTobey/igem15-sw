<!doctype html>
<html>
<head>
<title>MicroMaps WebShell</title>
<script src="../assets/jquery-1.11.3.min.js"></script>
<script src="../assets/jquery-migrate-1.2.1.min.js"></script>

<script>
function restartCam() {
d=new Date();
$("#cam").html("<img src='/_stream/?action=stream&date="+d.getTime()+"' />");
}


$(document).ready(function(){
$("#cam").html("Connecting...")
setTimeout(restartCam, 1000)

$("#camhold").on("click", function(){
$("#cam").html("Reconnecting...");
$.ajax({
  url: "/_webshell/control/power/on",
  context: document.body
}).done(function(){setTimeout(restartCam, 1000)});
});

$("#camrel").on("click", function(){
$.ajax({
  url: "/_webshell/control/power/off",
  context: document.body
}).done(function(){});
});

$("#led1").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/set/1",
  context: document.body
}).done(function(){$("#ledmode").html("1")});
});

$("#led2").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/set/2",
  context: document.body
}).done(function(){$("#ledmode").html("2")});
});

$("#led3").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/set/3",
  context: document.body
}).done(function(){$("#ledmode").html("3")});
});

$("#led0").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/set/0",
  context: document.body
}).done(function(){$("#ledmode").html("0")});
});

$("#ledtog").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/toggle/_",
  context: document.body
}).done(function(data){
$("#ledmode").html(data)
});
});

$("#ledreload").on("click", function(){
$.ajax({
  url: "/_webshell/control/reload/",
  context: document.body
}).done(function(data){});
});

$("#camcap").on("click", function(){
//$("#cam").html("Say cheese, little cells!")
$.ajax({
  url: "/_webshell/capture/",
  context: document.body
}).done(function(data){
$("#capt").html("<img src=\""+data+"\"/>")
setTimeout(restartCam, 1000)
});
});

$.ajax({
  url: "/_webshell/control/led/get/_",
  context: document.body
}).done(function(data){
$("#ledmode").html(data)
});

$.ajax({
  url: "/_webshell/control/power/on",
  context: document.body
})

});
</script>
<style>
#controlpanel {
float: right;
width: 400px;
}
</style>
</head>
<body>
<a href="/">Back</a><br />

<div id="controlpanel">
Camera:<br/><a href="#" id="camhold">Hold</a> <a href="#" id="camrel">Release</a> <br />
<a href="#" id="camcap">Capture</a><br /><br />
LED Mode (current: <span id="ledmode"></span>):<br /><a href="#" id="led0">Brightfield</a> <a href="#" id="led1">Fluorescence</a> <a href="#" id="led2">Darkfield</a> <a href="#" id="led3">Off</a> .... <a href="#" id="ledtog">Toggle</a><br /><br />
<a href="#" id="ledreload">Reload LED control</a><br /><br />
Motors: (TODO)
</div>

<div id="cam"></div>

<br />

Last captured image:
<div id="capt"></div>
<br />
<a href="/captured/">More captured images...</a>
</body>
</html>
