<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>WebShell</title>

    <link href="/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


    <style>
        html, body {height: 100%;}
        .container {height: 100%;}
#scalebar {
z-index: 10;
}
.ruler, .ruler li {
    margin: 0;
    padding: 0;
    list-style: none;
    display: inline-block;
}
/* IE6-7 Fix */
.ruler, .ruler li {
    *display: inline;
}
.ruler {
    background: lightYellow;
    box-shadow: 0 -1px 1em hsl(60, 60%, 84%) inset;
    border-radius: 2px;
    border: 1px solid #222;
    color: #222;
    margin: 0;
    height: 3em;
    padding-right: 1cm;
    white-space: nowrap;
}
.ruler li {
    padding-left: 1cm;
    width: 2em;
    margin: .64em -1em -.64em;
    text-align: center;
    position: relative;
    text-shadow: 1px 1px hsl(60, 60%, 84%);
}
.ruler li span {
font-size: 80%;
}
.ruler li:before {
    content: '';
    position: absolute;
    border-left: 1px solid #222;
    height: .64em;
    top: -.64em;
    right: 1em;
}
    </style>
<script src="/assets/jquery-1.11.3.min.js"></script>
<script src="/assets/jquery-migrate-1.2.1.min.js"></script>
<script src="/assets/jquery-ui.js"></script>
  
<script>
function restartCam() {
d=new Date();
$("#cam").html("<img src='/_stream/?action=stream&date="+d.getTime()+"' />");
}


$(document).ready(function(){
$("#cam").html("Connecting...")
setTimeout(restartCam, 1000)

$("#camhold").on("click", function(){
$("#cam").html("Reconnecting...");
$.ajax({
  url: "/_webshell/control/power/on",
  context: document.body
}).done(function(){setTimeout(restartCam, 1000)});
});

$("#camrel").on("click", function(){
$.ajax({
  url: "/_webshell/control/power/off",
  context: document.body
}).done(function(){});
});

$("#led1").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/set/1",
  context: document.body
}).done(function(){$("#ledmode").html("1")});
});

$("#led2").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/set/2",
  context: document.body
}).done(function(){$("#ledmode").html("2")});
});

$("#led3").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/set/3",
  context: document.body
}).done(function(){$("#ledmode").html("3")});
});

$("#led0").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/set/0",
  context: document.body
}).done(function(){$("#ledmode").html("0")});
});

$("#ledtog").on("click", function(){
$.ajax({
  url: "/_webshell/control/led/toggle/_",
  context: document.body
}).done(function(data){
$("#ledmode").html(data)
});
});

$("#camcap").on("click", function(){
//$("#cam").html("Say cheese, little cells!")
$.ajax({
  url: "/_webshell/capture/",
  context: document.body
}).done(function(data){
$("#capt").html("<img src=\""+data+"\"/>")
setTimeout(restartCam, 1000)
});
});


$("#motx").on("click", function(){
$("#motx").attr("disabled", "true")
$.ajax({
  url: "/_webshell/control/motor/0/"+($("#motx_").attr("value")),
  context: document.body
}).done(function(){$("#motx").removeAttr("disabled")});
});
$("#motxb").on("click", function(){
$("#motxb").attr("disabled", "true")
$.ajax({
  url: "/_webshell/control/motor/0/"+(parseInt($("#motx_").attr("value"))*(-1)),
  context: document.body
}).done(function(){$("#motxb").removeAttr("disabled")});
});

$("#moty").on("click", function(){
$("#moty").attr("disabled", "true")
$.ajax({
  url: "/_webshell/control/motor/1/"+($("#moty_").attr("value")),
  context: document.body
}).done(function(){$("#moty").removeAttr("disabled")});
});
$("#motyb").on("click", function(){
$("#motyb").attr("disabled", "true")
$.ajax({
  url: "/_webshell/control/motor/1/"+(parseInt($("#moty_").attr("value"))*(-1)),
  context: document.body
}).done(function(){$("#motyb").removeAttr("disabled")});
});

$("#motz").on("click", function(){
$("#motz").attr("disabled", "true")
$.ajax({
  url: "/_webshell/control/motor/2/"+($("#motz_").attr("value")),
  context: document.body
}).done(function(){$("#motz").removeAttr("disabled")});
});
$("#motzb").on("click", function(){
$("#motzb").attr("disabled", "true")
$.ajax({
  url: "/_webshell/control/motor/2/"+(parseInt($("#motz_").attr("value"))*(-1)),
  context: document.body
}).done(function(){$("#motzb").removeAttr("disabled")});
});


$.ajax({
  url: "/_webshell/control/led/get/_",
  context: document.body
}).done(function(data){
$("#ledmode").html(data)
});

$.ajax({
  url: "/_webshell/control/power/on",
  context: document.body
})


$('html').keyup(function(e){
    if(e.keyCode == 38){
$.ajax({
  url: "/_webshell/control/motor/1/"+((-1)*($("#motx_").attr("value"))),
  context: document.body
}).done();
e.preventDefault();
    }
    if(e.keyCode == 39){
$.ajax({
  url: "/_webshell/control/motor/0/"+($("#moty_").attr("value")),
  context: document.body
}).done();
e.preventDefault();
    }
    if(e.keyCode == 37){
$.ajax({
  url: "/_webshell/control/motor/0/"+((-1)*($("#moty_").attr("value"))),
  context: document.body
}).done();
e.preventDefault();
    }
    if(e.keyCode == 40){
$.ajax({
  url: "/_webshell/control/motor/1/"+($("#motx_").attr("value")),
  context: document.body
}).done();
e.preventDefault();
    }
    if(e.keyCode == 65){
$.ajax({
  url: "/_webshell/control/motor/2/"+($("#motz_").attr("value")),
  context: document.body
}).done();
    }
    if(e.keyCode == 83){
$.ajax({
  url: "/_webshell/control/motor/2/"+((-1)*($("#motz_").attr("value"))),
  context: document.body
}).done();
    }
if(e.keyCode == 16){
$.ajax({
  url: "/_webshell/control/led/toggle/_",
  context: document.body
}).done(function(data){$("#ledmode").html(data)});
    }

});

$("#tl").click(function(){
// send tl
var times = parseInt($("#delay").attr("value")), delay = parseInt($("#times").attr("value"))

$.ajax({
  url: "/_webshell/timelapse/set/"+delay+"/"+times,
  context: document.body
})
$("#currtl").html("Timelapse in progress...")
ensureTl()
setTimeout(ensureTl, 1000 * delay * times + 1000);
})

ensureTl()
setInterval(ensureTl, 10000)

$("#scalebar").draggable();
//$("#scalebar").html("");
$(".ruler[data-items]").each(function() {
        var ruler = $(this).empty(),
            len = Number(ruler.attr("data-items")) || 0,
            item = $(document.createElement("li")),
            i;
        for (i = 0; i < len; i++) {
            ruler.append(item.clone().html("<span>"+((i + 1)*20)+(i == (len-1) ? "&nbsp;&nbsp;&nbsp;microns": "")+"</span>"));
        }
    });
$(".ruler").css("padding-right", "172px").find("li").
            css("padding-left", "57.63px").
            find("span").css("margin-left", "-25px")

});

function ensureTl(){
$.ajax({
  url: "/_webshell/timelapse/get/",
  context: document.body,
  dataType: "json",
  success: function(json){
     if(json[0] != '') {
         $("#currtl").html("Timelapse in progress...")
     } else $("#currtl").html("")
  }
 })
}

</script>

  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">WebShell.</a>
        </div>
      </div>
    </nav>

    <div class="container" style="margin-top: 50px">
      <div class="row" style="height: 100%">
        <div class="col-md-4" style="width: 70%">
          <h2>Live view</h2>
          <p><div id="cam"></div></p>
<p><div id="scalebar"><ul class="ruler" data-items="25"></ul>
</div></p>
<p>
Last captured image:
<div id="capt"></div>
<br />
<a href="/captured/">More captured images...</a>
<a style="float:right" href="/_webshell/prune/">Prune your old files to under 50M</a> <br />
<a style="float:right" href="/_webshell/pruneall/">Prune everyone's old files to under 500M</a>
</p>
        </div>
        <div class="col-md-4" style="width: 30%;">
          <h2>Camera Control</h2>
          <p><center>
<a class="btn btn-default" href="#" role="button" id="camhold">Hold</a>
<a class="btn btn-default" href="#" role="button" id="camrel">Release</a>
 <a class="btn btn-default btn-success" href="#" role="button" id="camcap">Capture</a>
           </center></p>

         <h2>LED Control</h2>
          <p>Current LED: <span id="ledmode"></span> </p>
          <p><center>
<a class="btn btn-default" href="#" role="button" id="led0">Brightfield</a>
<a class="btn btn-default" href="#" role="button" id="led1">Fluorescence</a>
<a class="btn btn-default" href="#" role="button" id="led2">Off</a><br/>
<a class="btn btn-default btn-warning" href="#" role="button" id="ledtog">Toggle</a>
</center></p>
          <h2>Motor Control</h2>
          <p>
        <form class="form-inline">
X: <input type="text" class="input-large" value="100" id="motx_" /> <a class="btn btn-default" href="#" role="button" id="motx">Go!</a> <a class="btn btn-default" href="#" role="button" id="motxb">Back!</a><br />
Y: <input type="text" class="input-large" value="100" id="moty_" /> <a class="btn btn-default" href="#" role="button" id="moty">Go!</a> <a class="btn btn-default" href="#" role="button" id="motyb">Back!</a><br />
Z: <input type="text" class="input-large" value="600" id="motz_" /> <a class="btn btn-default" href="#" role="button" id="motz">Go!</a> <a class="btn btn-default" href="#" role="button" id="motzb">Back!</a><br />
</form>
</p>
          <h2>Timelapse</h2>
          <center><p>
<div id="currtl"></div>
Delay between images (seconds): <input type="text" id="delay" value="60" /><br />
Number of images to take: <input type="text" id="times" value="2" /></p><p>
<a href="#" role="button" class="btn btn-default btn-danger" id="tl">Set timelapse</a>
</p></center>

         </div>
<br style="clear:both"/>
      <hr>

      <footer>
        <p>Made with &hearts; from Cambridge-JIC iGEM 2015</p>
      </footer>
    </div> <!-- /container -->

    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="/assets/bootstrap/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>


