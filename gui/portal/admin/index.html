<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Admin | OpenScope</title>

    <link href="/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/awesome/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="/assets/jquery-1.11.3.min.js"></script>
<style>
.main {
padding-top: 25px;
}
</style>

  </head>

  <body>

<script>

</script>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Admin Panel.</a>
        </div>
<div id="navbar" class="collapse navbar-collapse" style="float: right">
          <ul class="nav navbar-nav">
            <li><a href='javascript:(function(c){var a,b="You should be logged out now.";try{a=document.execCommand("ClearAuthenticationCache")}catch(d){}a||((a=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void 0)?(a.open("HEAD",c||location.href,!0,"logout",(new Date).getTime().toString()),a.send(""),a=1):a=void 0);a||(b="Your browser is too old or too weird to support log out functionality. Close all windows and restart the browser.");alert(b);location.reload()})(/*pass safeLocation here if you need*/);'>Logout</a></li>
            <li><a href="/">&#8593; Up</a></li>
          </ul>
        </div>
      </div>
    </nav>
<br style="clear:both">
    <div class="container">

      <div class="main">
        <center><h1>User Access Control</h1></center>
<br /><i><center>This will only work if you are logged in as admin!</i></center><hr /><br /><br />
<div class="row">
<div id="userlist">
</div>
<a href="#" id="add">Add</a> <a href="#" id="del">Remove</a> <a href="#" id="kick">Kick streams from current sessions</a>

<div id="editor" style="display:none">
<span id="usrshow">Username: <input type="text" id="usr" /><br /></span>
Password: <input type="password" id="pass" /><br />
Enabled? <input type="checkbox" id="enab" /><br />
<input type="button" value="Save" id="save" />
</div>
      </div>

      </div>
<hr />
<p>Feelin' old? Go <a href="oldindex.html">retro</a>.</p>
      <hr/>

      <footer>
        <p><center>Made with &hearts; from Cambridge-JIC iGEM 2015</center></p>
      </footer>
    </div><!-- /.container -->

<script>
function reloadUsers() {
$.getJSON( "/_admin/get/", function( data ) {
    $("#userlist").html("")
    addData(data, 0)
    $.getJSON( "/_admin/get_disabled/", function( data ) {
        addData(data, 1)
    });
})
}

reloadUsers()

$("#save").on("click", function() {
    if(addNew == 1) {
        selectedUser = $("#usr").attr("value")
    }
    $.ajax("/_admin/set/" + escape(selectedUser) + "/" + escape($("#pass").attr("value"))).done(function(){
        if($("#enab").attr("checked") == "checked")
            $.ajax("/_admin/enable/"+escape(selectedUser))
        else
            $.ajax("/_admin/disable/"+escape(selectedUser))
        reloadUsers()
        selectedUser = ""
        $("#editor").hide()
        $(".user").css("background-color", "white")
    })
})

$("#del").on("click", function() {
    if(selectedUser != "") {
        $(".user").css("background-color", "white")
        $.ajax("/_admin/del/"+escape(selectedUser)).done(function(){
            reloadUsers()
        })
        selectedUser = ""
        $("#editor").hide()
    }
})

$("#kick").on("click", function() {
    $.ajax("/_admin/kick/").done(function(){
    })
})

$("#add").on("click", function(){
    $(".user").css("background-color", "white")
    addNew = 1
    selectedUser = ""
    $("#usr").attr("value", "")
    $("#pass").attr("value", "")
    $("#enab").attr("checked", "checked")
    $("#usrshow").show()
    $("#editor").show()
})

function addData(data, dis) {
    var items = [];
    $.each( data, function( key, val ) {
        items.push( "<li>" + (dis == 1 ? "(disabled) " : "") + "<a href='#' onclick='onClick(this)' class='user' data-dis='"+dis+"'>" + val + "</a></li>" );
    });
 
    $( "<ul/>", {
        html: items.join( "" )
    }).appendTo("#userlist");
}

var selectedUser = "", addNew = 0

function onClick(item) {
    selectedUser = $(item).html()
    addNew = 0
    $(".user").css("background-color", "white")
    $(item).css("background-color", "grey")

    $("#usr").attr("value", "")
    $("#pass").attr("value", "")
    if($(item).data("dis") == 0)
        $("#enab").prop("checked", true);
    else
        $("#enab").prop("checked", false);
    $("#editor").show()
    $("#usrshow").hide()
}

</script>

    <script src="/assets/bootstrap/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="/assets/bootstrap/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>

